let fs = require("fs");

let files = [];
let docRoot = "./src/Documentation/doc";
let processDir = (dir) => {
  console.log(dir);
  for (let file of fs.readdirSync(dir)) {
    let path = `${dir}/${file}`;
    if (fs.lstatSync(`${dir}/${file}`).isDirectory()) {
      processDir(path);
      continue;
    }
    if (path.startsWith(docRoot + "/")) {
      files.push(path.slice(docRoot.length + 1));
    }
  }
};
processDir(docRoot);

let autogenfile = `// THIS FILE IS AUTOGENERATED
${files.map((f, i) => `import file${i} from "./doc/${f}?raw";`).join("\n")}

import type { Document } from "./root.ts";

export let AllPages: Record<string, Document> = {};
${files.map((f, i) => `AllPages["${f}"] = file${i};`).join("\n")}
`;

fs.writeFile(docRoot + "/../pages.ts", autogenfile, (err) => {
  if (err) {
    console.error(err);
  }
  // file written successfully
});
